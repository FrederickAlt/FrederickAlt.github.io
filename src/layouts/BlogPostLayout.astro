---
import BaseLayout from './BaseLayout.astro';
import { siteConfig } from '../../site.config';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    pubDate: Date;
    topics: string[];
    keywords?: readonly string[] | string[];
    image?: string;
  };
}

const { frontmatter } = Astro.props;
const postURL = new URL(Astro.url.pathname, siteConfig.site.url);

// JSON-LD structured data for blog post
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: frontmatter.title,
  description: frontmatter.description,
  datePublished: frontmatter.pubDate.toISOString(),
  dateModified: frontmatter.pubDate.toISOString(),
  author: {
    '@type': 'Person',
    name: siteConfig.site.author,
  },
  publisher: {
    '@type': 'Person',
    name: siteConfig.site.author,
  },
  url: postURL.toString(),
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': postURL.toString(),
  },
};
---

<BaseLayout
  title={frontmatter.title}
  description={frontmatter.description}
  keywords={frontmatter.keywords}
  image={frontmatter.image}
  type="article"
  publishedTime={frontmatter.pubDate.toISOString()}
  modifiedTime={frontmatter.pubDate.toISOString()}
>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} is:inline />
  <article class="max-w-4xl mx-auto">
    <header class="mb-12">
      <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-title mb-6 leading-tight tracking-tight pb-4 border-b-2 border-slate-600">
        {frontmatter.title}
      </h1>

      <p class="text-xl text-slate-300 mb-6 leading-relaxed">
        {frontmatter.description}
      </p>

      <time datetime={frontmatter.pubDate.toISOString()} class="text-slate-400 font-medium">
        {frontmatter.pubDate.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        })}
      </time>
    </header>

    <div class="prose prose-lg max-w-none bg-surface rounded-lg p-10 shadow-soft border border-slate-600">
      <slot />
    </div>
  </article>
</BaseLayout>

<style is:global>
  .prose {
    @apply text-slate-300;
  }

  .prose h1 {
    @apply text-4xl font-bold text-title mt-8 mb-4 pb-3 border-b-2 border-slate-600;
  }

  .prose h2 {
    @apply text-3xl font-bold text-title mt-12 mb-4 pb-3 border-b-2 border-slate-600;
  }

  .prose h3 {
    @apply text-2xl font-bold text-title mt-8 mb-3;
  }

  .prose h4 {
    @apply text-xl font-bold text-title mt-6 mb-2;
  }

  /* Remove top margin from first child to prevent double spacing */
  .prose > :first-child {
    @apply mt-0;
  }

  .prose p {
    @apply mb-6 leading-relaxed;
  }

  .prose a {
    @apply text-primary-400 hover:text-primary-300 underline decoration-2 underline-offset-2 transition-colors;
  }

  .prose ul, .prose ol {
    @apply mb-6 ml-6 space-y-2;
  }

  .prose li {
    @apply leading-relaxed;
  }

  .prose ul li {
    @apply list-disc;
  }

  .prose ol li {
    @apply list-decimal;
  }

  /* Inline code (single backticks) */
  .prose :not(pre) > code {
    @apply bg-background text-slate-200 px-2 rounded text-sm font-mono border border-slate-700;
    padding-top: 0.1875rem;
    padding-bottom: 0.1875rem;
    white-space: nowrap;
  }

  /* Code inside links */
  .prose a code {
    @apply text-primary-400;
  }

  .prose a:hover code {
    @apply text-primary-300;
  }

  /* Code blocks (triple backticks) */
  .prose pre {
    @apply bg-slate-950 text-slate-100 p-6 rounded-lg overflow-x-auto mb-6 shadow-inner border border-slate-700;
  }

  .prose pre code {
    @apply bg-transparent text-slate-100 p-0 border-0;
  }

  .prose blockquote {
    @apply border-l-4 border-primary-500 pl-6 italic text-slate-300 my-6 py-2;
  }

  .prose img {
    @apply rounded-lg shadow-soft-lg mx-auto block;
  }

  /* Center images wrapped in divs */
  .prose div[style*="text-align: center"] img {
    @apply mx-auto block;
  }

  .prose hr {
    @apply my-12 border-slate-600;
  }

  .prose table {
    @apply w-full mb-6 border border-slate-600 rounded-lg overflow-hidden;
  }

  .prose th {
    @apply bg-background-light p-3 text-left font-bold text-slate-100;
  }

  .prose td {
    @apply p-3 border-t border-slate-600 text-slate-300;
  }
</style>
